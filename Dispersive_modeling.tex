\documentclass[review]{elsarticle}

%\usepackage{natbib}
\usepackage{lineno,hyperref}
\usepackage{amsmath}
\modulolinenumbers[5]
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tikz}

\journal{Coastal Engineering}

%%%%%%%%%%%%%%%%%%%%%%%
%% Elsevier bibliography styles
%%%%%%%%%%%%%%%%%%%%%%%
%% To change the style, put a % in front of the second line of the current style and
%% remove the % from the second line of the style you would like to use.--00
%%%%%%%%%%%%%%%%%%%%%%%

%% Numbered
%\bibliographystyle{model1-num-names}

%% Numbered without titles--
%\bibliographystyle{model1a-num-names}

%% Harvard
%\bibliographystyle{model2-names.bst}\biboptions{authoryear}

%% Vancouver numbered
%\usepackage{numcompress}\bibliographystyle{model3-num-names}

%% Vancouver name/year
%\usepackage{numcompress}\bibliographystyle{model4-names}\biboptions{authoryear}

%% APA style
%\bibliographystyle{model5-names}\biboptions{authoryear}

%% AMA style
%\usepackage{numcompress}\bibliographystyle{model6-num-names}

%% `Elsevier LaTeX' style
\bibliographystyle{elsarticle-num-names}\biboptions{authoryear}
%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\begin{frontmatter}

\title{Dispersive modeling of breaking waves  on a slope}

%% Group authors per affiliation:
\author[1]{Jihwan Kim}
\author[1]{Geir K. Pedersen}
\author[1,2]{Finn L{\o}vholt}
\author[3]{Randall J. LeVeque}

\address[1]{University of Oslo, Department of Mathematics, 
Oslo, Norway}
\address[2]{Norwegian Geotechnical Institute,
Oslo, Norway}
\address[3]{University of Washington, Department of Applied Mathematics, Seattle, USA}

\begin{abstract}

The nonlinear shallow water model is widely used
in the study of tsunami propagations
where the wave dispersion is ignorable.
If the wave dispersion becomes important,
Boussinesq-type models are often used. 
In this work, an operational Boussinesq solver, 
{\em BoussClaw}, is introduced
for modeling fully non-linear dispersive tsunami propagation, 
taking into account inundation. 
In the \textsc{BoussClaw} model,
Boussinesq equations from the literatures, 
based on the depth-averaged velocity 
and with enhanced dispersion properties, 
are implemented using a hybrid of the finite volume
and finite difference methods.
In order to validate \textsc{BoussClaw}, 
numerical results are compared 
to the analytical solutions and laboratory experiments. 
Furthermore, the  wave steepening and breaking motion
is explored with the help of the full potential 
boundary integral model, 
and we demonstrate that the point of wave breaking
may be misinterpreted in Boussinesq models. 

\end{abstract}

\begin{keyword}
Breaking wave, Boussinesq equation, finite volume method
\end{keyword}

\end{frontmatter}

\linenumbers

\section{Introduction}

Tsunamis are often considered as long waves compared to the water depth, and 
depth-averaged wave models are consequently widely used in the study of their propagation and inundation.
Through the use of numerical shock capturing techniques for modeling
the nearshore bore formation of the tsunami, {\em nonlinear shallow water} (NLSW) models
have become the standard model for modeling tsunami propagation and run-up, see e.g. 
\citep{titov1995modeling,Imamura1996b,Harig2008,BergerGeorgeLeVequeMandli11}.
Well known applications include inundation modeling of the recent major tsunami events 
such as the 2004 Indian Ocean tsunami \citep{Borrero2006,Kaiser2011} and the 2011 Tohoku tsunami \citep{Hooper2013,Romano2014}. 

The  NLSW models do not incorporate frequency dispersion and  are valid only for large wavelength-to-depth-ratios ($\lambda/h>20$).
The accumulated effect of the frequency dispersion for the wave propagation over the open sea is 
a function of propagation time and the shape of the disturbance \citep{Glimsdal2013},
and may become important for some tsunamis, in particular for landslide sources \citep{Lovholt2015}. 
Dispersion may further be of importance, in combination with non-linear effects,
for the evolution of undular bores \citep{Behrens2015}.
{\em Boussinesq-type models} that allow for more accurate modeling of shorter waves, may be used to model dispersive tsunamis.
In the last decades we have seen a development on long wave expansions and their numerical formulations. 
New Boussinesq type formulations, such as those introduced by \cite{madsen1992new}, and \cite{nwogu1993alternative}, displayed improved accuracy, as well as extended validity ranges in comparison to the standard formulation of \cite{peregrine1967long}.

In their original formulation, Boussinesq-type models 
do not take into account the post-breaking motion. 
In order to combine breaking with  the Boussinesq-type equations
several strategies have therefore been suggested. For instance, \citet{peregrine1967long} used $A/h=0.6$ 
as the break threshold, while pointing out that this value could reaches around $2$ in laboratory experiments. 
Another way of incorporating the breaking that was suggested by \cite{Kennedy2000} included diffusive terms
in the momentum equation to smear out sharp fronts. \citet{Lovholt:2013a} similarly employed a diffusive model including transport terms, but pointed out that breaking wave Boussinesq models were prone to instabilities. 
\citet{schaffer1993boussinesq} introduced the concept of the {\em surface roller}. \citet{lynett2006nearshore} investigated $\eta_t/c$, $\eta_x$, $u_{xx} H^2/c$, and $u/c$, 
where $c=\sqrt{gH}$, $u$ is the wave speed and $\eta$ is 
the water surface elevation, 
and then identified that the critical front slope ($\eta_x$) 
is the least sensitive breaking threshold. \citet{tissier2012new} suggested
a breaking decision model based on the surface roller, the maximal front angle and the Froude number.
An alternative non-linear diffusive ad-hoc breaking term was suggested \citet{matsuyama2007study},
based on their large scale experiments of the wave propagation of undular bores on various slope angles. 
%They studied the wave breaking criteria and suggested 
%\begin{align*}
%\frac{u_s}{c} = \frac{\eta}{H} - \frac{h}{3H}
%\left(
%H\frac{\partial^2 \eta}{\partial x^2} - 2 \left(\frac{\partial \eta}{\partial x} \right)^2
%\right),
%\end{align*}
%as a wave breaking criterion.

Recent developments of operational Boussinesq models, have made use of more sophisticated hybrid numerical techniques
such as use of approximate Riemann solvers combined with TVD limiters for the conserved variables, and finite differences
for additional higher order terms \citep{Erduran2005,Kim2009,shi2012high}, leading among others to the popular
\textsc{Funwave-TVD} and \textsc{Coulwave-TVD} applications. For instance in \citet{shi2012high}, Boussinesq terms are 
switched off the near-shore region where large amplitude-to-depth-ratios occur,
implying that only NLSW terms remain in the shallowest region.
This allows for a relatively robust treatment of the modeling of the post breaking phase. To this end,
the $A/h = 0.8$ threshold suggested by \citep{shi2012high} 
based on the Froude similarity analysis by \citet{tonelli2009hybrid}, have in many ways become the standard for incorporating
breaking in a feasible and practical way.

In this paper, we present a new hybrid Boussinesq type model \textsc{BoussClaw}, 
of similiar mould as \textsc{Funwave-TVD} and \textsc{Coulwave-TVD}. The emphasis is twofold.
First, to present a careful validation of the model, both towards  
laboratory experiments and more general reference models. Second, we use the new model
in comparison with a full potential reference model to explore how accurate the Boussinesq models 
can represent the wave evolution until the point of breaking. In the present example,
we are finally able to demonstrate that Boussinesq models may be employed
to accurately model the near shore tsunami propagation beyond the standard $A/h = 0.8$ threshold depth.
Conversely, we find that the use of the standard $A/h = 0.8$ threshold depth 
invokes a too early formation of a breaking bore. This points out that  
that the breaking criteria employed so far lacks generality.
%While these criteria may be attractive due to robustness, 
%they may be lacking not only for modeling the breaking phase, but %in certain situation also the pre-breaking phase.
%\marginpar{\footnotesize Move to last part of this paragraph to conclusions (or omit this)?}

This paper is organized as follows: In Section \ref{sec:model}, the base model
for the wave equations is given and the numerical scheme is outlined, including a von Neuman stability analysis. 
Sections \ref{sec:num_nonbreaking} compares results from the \textsc{BoussClaw} with
the analytic solutions and laboratory experiments. 
Section \ref{sec:wave_break} discusses the wave steepening and using a Boundary Integral Method (BIM) for 
solving the full potential equations. 
In Section \ref{sec:num_breaking}, 
we compare these results of pre-breaking
evolution with Boussinesq type models.

\section{Model Description}
\label{sec:model}

Boussinesq-type equations include non-hydrotstic pressure in an approximate way
treat short waves more accurately
than the shallow water equations. 
The Boussinesq-type wave models have been derived by retaining 
$\mathcal{O}(\epsilon)$ and $\mathcal{O}(\mu)$ terms, 
where $\epsilon$ and $\mu$ 
denote the ratio of wave amplitude to depth
and the ratio of depth to wavelength respectively. 
Various models have been suggested,
and the papers of \citet{peregrine1967long},
\citet{madsen1992new}, \citet{nwogu1993alternative},
\citet{lynett2002modeling},
and \citet{wei1995time}
are representative examples. 

In this work, a new numerical model, 
called \textsc{BoussClaw}, is introduced. 
It is an extension of \textsc{Geoclaw} \citet{clawpack},
and solves 
the Boussinesq-type equations derived by
\citet{schaffer1993boussinesq}.
The \textsc{BoussClaw} model
is a hybrid of the finite volume and finite difference solvers
with the operation splitting technique.
The \textsc{Geoclaw} software is 
a part of \textsc{Clawpack} \citet{clawpack}
by \citet{leveque1997wave}, \citet{george2008augmented}
and \citet{BergerGeorgeLeVequeMandli11}
which is designed to solve the nonlinear shallow water equations.
%with properties such as high-resolution, total variation diminishing (TVD) and adaptive mesh refinements (AMR).
% The wave propagation algorithms by LeVeque (1997) \cite{leveque1997wave} is implemented, and the steady state is preserved. 

\subsection{\textsc{BoussClaw} - a new long wave model for tsunami propagation and run-up}

\subsubsection{Boussinesq-type equations}

\citet{schaffer1993boussinesq} derived 
Boussinesq-type equations
with an addition of a Pad{\'e} approximation 
of the linear dispersion relation.
The equations read 
\begin{flalign}
& H_t + (Hu)_x  = 0, \label{eq:madsen_cons_mass} & \\ 
& (1-D)\big\lbrack(Hu)_t\big\rbrack + \left( Hu^2 + \frac{g}{2}H^2 \right)_x - gHh_x -Bgh^2\left(h\eta_x\right)_{xx} =0, \label{eq:madsen_momx} &
\end{flalign}
where the operator $D$ is defined as
\begin{flalign}
 D (w) &= \left(B+\frac{1}{2} \right)h^2 w_{xx} -\frac{1}{6} h^3 \left(\frac{w}{h}\right)_{xx}, & \label{eq:madsen_new_op}
\end{flalign}
for any $w(x,t)$.
In the above equations $H(x,t)$ and $u(x,t)$ are the total flow depth and the depth averaged velocity of the water, respectively, 
$h(x)$ is the still water depth, $\eta(x,t)$ is the surface elevation,
and thus $H(x,t)=h(x)+\eta(x,t)$. 
Moreover, $g$ is the acceleration of gravity, 
and $B$ is a dispersion parameter. 
\citet{madsen1992new} 
has chosen the parameter $B=1/15$ 
from a Pad{\'e}
expansion of the linear dispersion analysis.
When $B=0$, this set of the Boussinesq-type equations
approximately reduces to that of \citet{peregrine1967long}
as the linear dispersion relations are identical. 
However, unlike Peregrine's momentum equation 
the hydrostatic parts of (\ref{eq:madsen_momx}) 
are written in a conservative form.
This difference will be observed in the numerical procedure and is
further elaborated in \ref{append:a}.

The \textsc{BoussClaw} model
solves the Boussinesq-type equations (\ref{eq:madsen_cons_mass}) and (\ref{eq:madsen_momx}) numerically
with a hybrid combination of the finite volume and finite difference methods that will be explained in a moment. 
There have been several studies on this type of hybrid schemes.
For example, see \citet{tissier2011serre}, \citet{shi2012high} and \citet{dutykh2013finite}.


To facilitate a fractional step method, as outlined below, we move the hydrostatic terms of (\ref{eq:madsen_momx}) inside the $(1-D)$ 
operator, while balancing with extra terms in the $\Psi$, to obtain
\begin{flalign}
& (1-D)\big\lbrack (Hu)_t + \left(Hu^2 + \frac{g}{2}H^2 \right)_x - gHh_x\big\rbrack = -\Psi(x,t), & \label{eq:hybrid_src}
\end{flalign}
where
\begin{flalign}
\Psi(x,t)= & \left(B+\frac{1}{2} \right) h^2 \left( (Hu^2)_{x} + g H \eta_x \right)_{xx} \nonumber\\
& -\frac{1}{6}h^3 \left( \frac{ (Hu^2)_x +gH\eta_x }{h} \right)_{xx}
-Bgh^2\left(h\eta_x\right)_{xx}. &
\label{eq:madsen_new_disp_x}
\end{flalign}

\subsubsection{Numerical scheme}
\label{sec:Num_scheme}
The equations (\ref{eq:madsen_cons_mass}) and (\ref{eq:hybrid_src}) are 
written in a form that conserves momentum to leading order in $\mu$, but with the $\Psi$
term as a pseudo source.
Such equations may be solved  
by a {\em fractional step method} as described in  
\citet{leveque2002finite},
for instance. 
First, it is observed that (\ref{eq:hybrid_src}) may be formally
rewritten as 
\begin{flalign}
& (Hu)_t =- \left\lbrace\left(Hu^2 + \frac{g}{2}H^2 \right)_x - gHh_x\right\rbrace -(1-D)^{-1}\Psi(x,t), & \label{eq:hybrid_inv}
\end{flalign}
At the first stage of the hybrid scheme, we integrate $Hu$ over a time step
taking into account all hydrostatic terms, namely 
those within the braces on the right hand side, and omitting the source terms involving $\Psi$. 
When this is combined with the continuity equation
(\ref{eq:madsen_cons_mass}) this simply corresponds to advancing 
the shallow water equations one time step forward. 
To this end we employ \textsc{Geoclaw},
a high-order accurate finite volume solver 
for the shallow water equations with adaptive mesh refinements.

%\marginpar{\small add a descriptio of the NLSW procedure}

In the second stage, we retain the new $H$ value, but integrate $Hu$ (essentially being the momentum density) further 
from the first stage by solving
\begin{flalign}
& \left(1-D \right)\big\lbrack (Hu)_t\big\rbrack = -\Psi . & \label{eq:hybrid_mom_fdm}
\end{flalign}
Since the differential operator $D$ contains spatial derivatives,
a systems of difference equations must then be solved. 

The spatial and time discretization should be carefully chosen 
for the stability of the second stage. 
In our numerical scheme, the second order centered scheme
is used for the spatial discretization, 
and a four stage Runge-Kutta method is used for the time integration.
The von Neumann stability analysis of this numerical scheme 
is outlined in \ref{append:stab}.

Suppose the spatial domain is divided into $n$ grid cells with 
the spatial grid size $\Delta x$.
Arrays of nodal values for flow depth and $Hu$, respectively, are
defined as
\begin{flalign*}
\textbf{H} & =
(H_1,H_2, \dots , H_n)^T, & \\
\textbf{M} & =
(H_1u_1,H_2u_2, \dots , H_nu_n)^T. &
\end{flalign*}

With time increment $\Delta t$ the fourth order Runge-Kutta scheme
can be written as follows,
\begin{flalign}
\textbf{M}^1 = \textbf{M}, \quad 
\textbf{M}^2 = \textbf{M} + \frac{\Delta t}{2}\textbf{S}^1, \quad
\textbf{M}^3 = \textbf{M} + \frac{\Delta t}{2}\textbf{S}^2, \quad
\textbf{M}^4 = \textbf{M} + \Delta t \textbf{S}^3,
\label{eq:rk4_S}
\end{flalign}
where $\textbf{M}^k$ are intermediate value arrays
%\marginpar{How are values for $H$ obtained in the steps; linear interpolation ?} 
and $\textbf{S}^k$ are
correpondingly arrays for the time derivatives of $Hu$, obtained by
solving 
\begin{flalign}
(I-\bar{D})\textbf{S}^k & 
= -\bar{\Psi}(\textbf{H},\textbf{M}^k), \quad \textrm{for~} k=1,\dots,4. &
\label{eq:rk4_1}
\end{flalign}
Here $\bar{\Psi}$ and $\bar{D}$ represent centered spatial discretizations for the term $\Psi$ and the operator $D$, respectively. These
are given explitly below.
Finally the value of $\textbf{M}$ at the new time level is
obtained by
\begin{flalign}
\textbf{M}^+ & = \textbf{M} + \frac{\Delta t}{6} \left[
\textbf{S}^1+2\textbf{S}^2+2\textbf{S}^3+\textbf{S}^4
\right]. 
\label{eq:rk4_assemble}
\end{flalign}

In (\ref{eq:rk4_1}), 
$\bar{D}$ is a tri-diagonal $n\times n$ matrix with elements 
\begin{flalign*}
 \bar{D}_{i,i-1} = & \frac{1}{\Delta x^2} \left[
 \left(B + \frac{1}{2} \right) h_i^2 
-\frac{1}{6} \frac{h_i^3}{h_{i-1}} \right],  & \\
 \bar{D}_{i,i} = & \frac{1}{\Delta x^2}
 \left(-2B - \frac{2}{3} \right) h_i^2 ,  & \\
 \bar{D}_{i,i+1} = & \frac{1}{\Delta x^2} \left[
 \left(B + \frac{1}{2} \right) h_i^2 
-\frac{1}{6} \frac{h_i^3}{h_{i+1}} \right].  & 
\end{flalign*}
Correspondingly, the $i$-th element of $\bar{\Psi(\textbf{H},\textbf{q})}$ is 
\begin{flalign*}
\bar{\Psi}_i 
&=  \left(B+\frac{1}{2} \right) \frac{h_i^2}{2\Delta x^3} 
\Bigg[
\left(\frac{M_{i+2}^2}{H_{i+2}} -2\frac{M_{i+1}^2}{H_{i+1}} 
+2\frac{M_{i-1}^2}{H_{i-1}}-\frac{M_{i-2}^2}{H_{i-2}} \right) \\
& +g\left(H_{i+1}\left(\eta_{i+2}-\eta_{i}\right)
-2H_{i}\left(\eta_{i+1}-\eta_{i-1}\right) 
+H_{i-1}\left(\eta_{i}-\eta_{i-2}\right) \right)\Bigg]  \\
& -\frac{1}{6}\frac{h_i^3}{2\Delta x^3} \Bigg[
 \frac{M_{i+2}^2/H_{i+2}-M_i^2/H_i}{H_{i+1}}
 -2\frac{M_{i+1}^2/H_{i+1}-M_{i-1}^2/H_{i-1}}{h_{i}} \\
& +\frac{M_{i}^2/H_{i}-M_{i-2}^2/H_{i-2}}{H_{i-1}}
 \\
 &+ g \left( \frac{H_{i+1}(\eta_{i+2}-\eta_{i})}{H_{i+1}} 
 -2 \frac{H_{i}(\eta_{i+1}-\eta_{i-1})}{h_{i}} 
 + \frac{H_{i-1}(\eta_{i}-\eta_{i-2})}{H_{i-1}} 
 \right) \Bigg] \\
& -\frac{Bgh_i^2}{2\Delta x^3}
\left( H_{i+1}\left(\eta_{i+2}-\eta_{i} \right)
-2H_{i}\left(\eta_{i+1}-\eta_{i-1} \right)
+H_{i-1}\left(\eta_{i}-\eta_{i-2} \right) \right), &
\end{flalign*}
for $i=1,2,\dots,n$.

\subsection{Models for comparison}
The performance of the Boussinesq model presented here is 
assessed by comparison with numerical results from a full potential
flow model which is described in \citet{Lovholt:2013a} and references therein. The model is based on a boundary 
integral technique and is run  with fully nonlinear solitary
wave solutions as initial conditions. During shoaling and breaking this
model can describe the evolution of a plunger, but breaks down
when the plunger reaches the free surface. Hence, the potential flow 
results are used to determine the point of breaking due to shoaling 
and to
evaluate the evolution of  amplitude and wave 
shape of the current model until this point.   
Below we refer to the full potential model as the BIM (Boundary
 Integral Method) model.

Comparison with a pre-existing, fully nonlinear Boussinesq model is
facilitated by the application of a Lagrangian model, described
in \citet{Lovholt:2013a}. Apart from the use of
Lagrangian coordinates the equations employed in this model are
 similar to (\ref{eq:madsen_cons_mass}) and (\ref{eq:madsen_momx}).
They differ only concerning the nonlinearities in the
dispersion terms and that  the dispersion optimization terms are added in a fully nonlinear fashion.
Presently, the Lagrangian model has no established bore capturing 
facility and is hence valid only to the point of breaking.
Results from this model will be referred to as 'Serre', even though
the dispersion enhancement is invoked. 
 
Results for the Peregrine-type Boussinesq equations are obtained by the
GloBouss model. This is a dispersive tsunami propagation model which
is based on Peregrine-type equations and discretization on a staggered grid. Further details are found in 
\citet{Lovholt:2008b}.

For comparison also the version 2.1 of the  \textsc{Funwave-TVD} model
by \citet{shi2012high} is used. The
\textsc{Funwave-TVD} model shares important features with \textsc{BoussClaw}, employing a hybrid 
of the finite volume and finite difference
scheme to solve the fully non-linear higher order dispersive Boussinesq model numerically.
While we refer to \citet{shi2012high} for details, we briefly note that \textsc{Funwave-TVD} is based the fully nonlinear 
Boussinesq equations of \citet{Chen06}. The numerical spatial representation in \textsc{Funwave-TVD} is MUSCL TVD scheme 
to discretize for the flux and first order terms, 
whereas a central finite difference
scheme \citet{Wei95} is utilized for the higher order momentum terms. A Runge-Kutta scheme is employed for the time stepping.

\section{Numerical Tests}
\label{sec:num_nonbreaking}

\subsection{Solitary wave propagation}

In order to validate the numerical approach 
a solitary wave propagation is tested on a constant water depth.
For the initial conditions, 
the analytic solitary wave solution 
of the Serre's equations is used
since analytic solutions are unknown 
for
the set (\ref{eq:madsen_cons_mass}) and 
(\ref{eq:madsen_momx}).
Solitary wave solutions to Serre's equations are given as
\begin{flalign}
\label{eq:anal_serre}
\begin{split}
& \eta(x,t) = A\, \textrm{sech}^2 \left( \kappa (x-ct)\right),  \\
& u(x,t) = c \frac{\eta(x,t)}{h},
\end{split} &
\end{flalign}
where
\begin{flalign}
\begin{split}
& \kappa = \frac{\sqrt{3h}}{2A\sqrt{A+h}}, \quad \textrm{and}
 \quad c = \sqrt{g\left( A + h \right)}.
\end{split} &
\end{flalign}
In this expression, $A$ and $h$ are constants
which represent the wave amplitude and the undisturbed water depth
respectively.

In Figure \ref{fig:soliton_ts}, 
snapshots from the \textsc{BoussClaw}'s simulation are shown 
at $t=0,4,8$ and $12$ with $\Delta x = 0.1$. 
For the initial conditions, the solution (\ref{eq:anal_serre})
is used with $A=0.2$, $h=1$ and $g=9.81$.
The computational results are in good agreement 
with the analytic solutions concerning height, shape and propagation speed. 
The amplitudes decreases very gently as the wave propagates. 
%The discreapancy may be  partially due to the numerical errors
%and partly to the fact that 
%the analytic solution for Serre's equations satisfies
%the present Boussinesq-type equations only approximately.

\begin{figure}[!htb]
\centering
\includegraphics[width=.8\textwidth]{_fig/soliton_ts.png}
\caption{Snapshot of the analytic and computed solitary wave 
at $t=0,4,8$ and $12$ with $A/h=0.2$. 
The wave propagates from right to left,
and the analytic solutions are black solid lines.}
\label{fig:soliton_ts}
\end{figure}

The wave energies for the shallow water equations 
and the Boussinesq equations are $E_0$ and $E_0+E_1$, respectively, where
\begin{flalign}
& E_0 = \frac{1}{2}\left( g\eta^2 + H\bar{u}^2 \right), \label{eq:energy_e0} \\
& E_1 = \frac{1}{6}H^3\bar{u}_x^2
+ \frac{1}{2}H^2h_x\bar{u}\bar{u}_x + \frac{1}{2}Hh_x^2\bar{u}^2.
\label{eq:energy_e1}
\end{flalign}
Details are given in \citep{madsen1997surf} 
and \ref{append:energy}.

%The wave energy is conserved 
%as long as the wave is smooth and do not break,
%and the energy decreases as the wave breaks.
%The energy can be divided into the potential energy and kinetic energy, and the potential energy of $E_0+E_1$ is $\frac{1}{2} g\eta^2$.

\begin{figure}[!htb]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{_fig/soliton_energy.png}
        \caption{Energy}
        \label{fig:soliton_energy}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{_fig/soliton_energy_dx.png}
        \caption{Relative error of energy}
        \label{fig:soliton_energy_dx}
    \end{subfigure}
    \caption{The energy of a solitary wave
    with $\Delta x = 0.2$ (left), 
    and log-log plot of relative error 
    at $t=10$ for $\Delta x = 0.05, 0.1, 0.2$ and $0.5$ (right).}
    \label{fig:soliton_error_energy}
\end{figure}

In Figure \ref{fig:soliton_energy}, the energy of the solitary
wave is shown with $A/h=0.2$ and $\Delta x = 0.2$.
There are fluctuations both in the potential and kinetic energy that is evident when we zoom in,
and the total energy decreases 
showing that the numerical procedure has dissipation.
In Figure \ref{fig:soliton_energy_dx},
the relative error of the energy at $t=10$,
\begin{flalign*}
Error = \frac{\left| E_{t=0}-E_{t=10} \right|}{\left|E_{t=0}\right|}, &
\end{flalign*}
is shown for different $\Delta x$.
For a solitary wave on a constant depth,
the energy dissipation decreases with the grid increments.

\subsection{Waves on a composite slope}

A physical model was constructed at the Coastal Hydraulic Laboratory of the U.S. Army Corps of Engineers
in order to address beach erosion and severe flooding problems \citet{chl_bp5}. 
The model beach consists of three piecewise linear slopes of 1:53, 1:150, and 1:13 with a vertical wall at the shoreline as shown in Figure \ref{fig:bp5_water_tank}.
In the laboratory, the wavemaker was located at 23.23 m.
The gauge data from three cases are provided 
where the ratio $A/h$ is equal to $0.038$, $0.259$ and $0.681$
with $h=21.8$ cm.

\begin{figure}[!htb]
\centering
\begin{tikzpicture}[scale=.55]
 \draw[line width=4pt] (0,-4) -- (0,3);
 \draw[line width=2pt] (0,-4) -- (5,-4) -- (7,-3) --(13,-2) -- (15,-0.5);
 \draw[line width=4pt] (15,-4)--(15,3);
 \node[below] at (0,-4) {Wave Maker};
 \node[below] at (15,-4) {Solid Wall};
 \draw[blue] (0,0) -- (15,0);
 \draw (1,-3) -- (1,2) node[above]{1};
 \draw (1.5,-3) -- (1.5,2) node[above]{2};
 \draw (2,-3) -- (2,2) node[above]{3};
 \draw (2.5,-3) -- (2.5,2) node[above]{4};
 \draw (5,-3) -- (5,2) node[above]{5};
 \draw (6,-2.5) -- (6,2) node[above]{6};
 \draw (7,-2) -- (7,2) node[above]{7};
  \draw (10,-2) -- (10,2) node[above]{8};
 \draw (13,-1.5) -- (13,2) node[above]{9};
 \draw (14,-0.8) -- (14,2) node[above]{10};
 \node[right] at (6,-4) {\small 1:53};
 \node[below] at (10,-2.7) {\small 1:150};
 \node[right] at (13.5,-2) {\small 1:13};
 \draw (0,4) -- (0,7);
 \draw (15,4) -- (15,7);
 \draw[<->] (0,6) -- (15,6);
 \node[above] at (7.5,6) {23.23 m};
 \draw[<->] (0,5) -- (5,5);
 \node[above] at (2.5,5) {15.04 m};
 \node[above] at (6,5) {4.36 m};
 \draw[<->] (5,5) -- (7,5);
 \node[above] at (10,5) {2.93 m};
 \draw[<->] (7,5) -- (13,5);
 \draw[<->] (13,5) -- (15,5);
 \node[above] at (14,5) {0.90 m};
 \draw (5,4) -- (5,5.5);
 \draw (7,4) -- (7,5.5);
 \draw (13,4) -- (13,5.5);
  \end{tikzpicture}
  \caption{A sketch of the water tank}
  \label{fig:bp5_water_tank}
\end{figure}

The second case with $A/h=0.259$ has been 
compared with the numerical tests
which employed $400$ grid points. 
%And the switching scheme between the shallow water equations and the Boussinesq equations, is not applied.
To specify the incoming wave from the left boundary, 
the data at Gauge 4 were used for the wave height,
and the corresponding velocity (\ref{eq:anal_serre})
was applied.

In Figure \ref{fig:bp5b_gauges}, water surface elevations at gauges 5, 7 and 8 are shown. 
The simulated waves are in good agreement with the laboratory measurements. 
For the reflected waves, larger discrepancies are observed.
The increased discrepancy occurs because the full interaction between the wave and the wall
at the right boundary is less accurately captured.
Friction forces influence the wave evolution along the shallow region near the right wall,
but we have not included these in the present numerical simulation.
A better fit may possibly be obtained by incorporating friction, however,
tuning the friction models is not the scope of this work. 

\begin{figure}[!htb]
\centering
\includegraphics[width=.8\textwidth]{_fig/gauge0005fig300.png}\\
\includegraphics[width=.8\textwidth]{_fig/gauge0007fig300.png}\\
\includegraphics[width=.8\textwidth]{_fig/gauge0008fig300.png}
\caption{Water surface elevation at gauges 5,7 and 8 for $A/h=0.269$ case.}
\label{fig:bp5b_gauges}
\end{figure}

%\marginpar{\footnotesize Geir: A very shallow region may yield %important frictional effects? But, surely, the wave should  break %in the shallowest region?}

\section{Simulation of wave steepening and breaking using a BIM model}
\label{sec:wave_break}

%Depth-averaged models are not capable of handling the wave breaking unless they are modified by incorporating the energy dissipation. In this work, a breaking solitary wave will be considered on a uniform slope. For laboratory experiments, see Synolakis \{synolakis1987runup}.

\citet{synolakis1987runup} performed a series of laboratory experiments for the run-up of solitary waves
on uniform slopes. Here, we are interested in the  breaking cases. 
One such example in \citet{synolakis1987runup} is a solitary wave of amplitude $A/h=0.28$ 
approaching a slope of $1:19.85$. In Figure \ref{fig:init_setup}, the initial set-up for a test is shown. 
%, and the experiment results include various cases with the wave amplitudes and slope angles. Synolakis identified the breaking and non-breaking wave cases. 

\begin{figure}[!htb]
\centering
\includegraphics[width=.7\textwidth]{_fig/initial_setup.png}
\caption{Set-up of a numerical test for Synolakis' experiments.}
\label{fig:init_setup}
\end{figure}

The set-up of the wave tank in the simulations follows the laboratory experiments by \citet{synolakis1987runup}. 
The bathymetry of the wave tank is composed of a horizontal bottom and 
a uniform slope as shown in Figure \ref{fig:init_setup}. 
A solitary wave of amplitude $A/h=0.28$ is generated at the right end of
the tank and propagates leftwards
to the beach. 

We present the results using the non-dimensional time 
$t^*=t\sqrt{h/g}$ and non-dimensional space $x^*=x/h$. In the following, we drop the asterisks in 
the presentation of the results. 
In  \citet{synolakis1987runup}, $t=0$ was defined as when the wave crest was a distance $L$ from the toe of the slope,
where $L$ was given as
\begin{flalign*}
& L = \sqrt{\frac{4A}{3h}} \textrm{arccosh} \left( \frac{1}{0.05} \right). &
\end{flalign*}
However, at $t=0$, the solitary wave has an elevation of
5\% of it maximum at the toe of the beach, meaning that the slope has
started to interact with the solitary wave. To avoid any such interaction obscuring
our analysis, we instead place the initial solitary wave using equation (\ref{eq:anal_serre}) 
at $L + 5c$, where $c$ is the shallow water wave celerity.
In this way, the initial solitary wave has a negligible interaction with the slope when initialized. 
%Then $t=0$ is set as soon as the peak of wave is at $x=L$.

In Figure \ref{fig:lab_bim}, the laboratory measurements
are shown with the computational results from the BIM model
for a breaking wave case of Synolakis with $A/h=0.28$ and $1:19.85$ slope at $t=15$.
%The results are in good agreement. 

\begin{figure}[!htb]
\centering
\includegraphics[width=\textwidth]{_fig/lab_bim_t15.png}
\caption{Comparison of the laboratory experiments and BIM at t=15 with $A/h=0.28$ 
on a slope of $1:19.85$.}
\label{fig:lab_bim}
\end{figure}

Figure \ref{fig:bim_breaking} shows
the numerical results from the BIM model at $t=17$, $18$ and  $18.6$.
In the BIM results a vertical front is observed at $x=4.02$ and $t=18.6$
with the maximum wave amplitude $A=0.414$, and this shows similarity with 
the analysis of \citet{titov1995modeling}
on the wave breaking point.
%\marginpar{\footnotesize What is the result of Titov and Synolakis?} 
%and the undisturbed depth is $h=0.206$ m. 
The ratio of amplitude to depth, $A/h$, 
is about $2.01$ at the break point.
The potential flow model cannot be run much beyond the
breaking points (until the attachment of the plunger only) and 
gives no information on the following bore propagation.
In Figure \ref{fig:sw_timeseries}, 
computations of the shallow water equations
(present model without the second fractional step) 
display a premature bore formation which checks the
amplification during the subsequent shoaling. 
As a consequence the amplitude 
in the shallow water equations simulation 
is markedly smaller than that of the 
potential flow model when the latter indicates breaking.

\begin{figure}[!htb]
\centering
\includegraphics[width=\textwidth]{_fig/bim_n7_time_series.png}
\caption{Computational results from BIM of a wave with $A/h=0.28$ 
on a slope of $1:19.85$.
A vertical front is observed at $t=18.6$. }
\label{fig:bim_breaking}
\end{figure}

%The computation of BIM can not proceed further after $t=19.2$ because of the singularity.

%One of the main reasons is to exclude the effect of the bottom friction. Without appropriate inclusion of the friction forces, the numerical results will not yield comparable results with the experiments. When different numerical models are compared, however, it is difficult to distinguish the friction errors from the modeling errors. Therefore, the numerical solution of BIM without any friction is considered as a solution.

%Figure \ref{fig:sw_timeseries} and \ref{fig:bous_timeseries} show the computational results from depth-averaged models, and both models do not capture the wave breaking properly.
%In Figure \ref{fig:bous_timeseries}, the numerical results from the \textsc{BoussClaw} are given, the amplitude of the incoming wave continues to increase and the wave does not break. 

\begin{figure}[!htb]
\centering
\includegraphics[width=\textwidth]{_fig/sw_dx05_time_series.png}
\caption{Computational results from NLSW at $t=10,15,17$ and $18.6$.}
\label{fig:sw_timeseries}
\end{figure}

%\begin{figure}[!htb]
%\centering
%\includegraphics[width=\textwidth]{_fig/bous_dx025_time_series.png}
%\caption{Computational results from \textsc{BoussClaw} 
%at $t= 5,9,13,17$ and $20$ s.  }
%\label{fig:bous_timeseries}
%\end{figure}

\section{Pre-breaking and breaking wave evolution using depth averaged models}
\label{sec:num_breaking}

We use the set-up described in section \ref{sec:wave_break} for the Boussinesq modeling of
solitary waves on a slope. Figure \ref{fig:bim_boussclaw} shows the snapshots of 
the water surface at t=$16$ and $18.6$
from BIM and \textsc{BoussClaw} with B=$0$ and $1/15$.
When the wave is smooth at t=16, the \textsc{BoussClaw}
results are similar.
At the breaking point, $t=18.6$, larger differences are observed. 
If $B=0$, the wave speed is slightly faster 
than the BIM result, but the wave amplitude is similar. 
When $B=1/15$, the wave speed matches the BIM results better,
but the amplitude is slightly smaller. 
In general, the computational results are rather similar
with $B=0$ and $1/15$. 

\begin{figure}[!htb]
\centering
\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_160.png}\\
\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_186.png}
%\includegraphics[width=.7\textwidth]{_fig/bim_boussclaw_192.png}
\caption{Snapshots of BIM and \textsc{BoussClaw} with B=$0$ and $1/15$ at t=$16$, and $18.6$.}
\label{fig:bim_boussclaw}
\end{figure}
%\marginpar{\footnotesize Lines in figure 10 indistinguishable Change line style or color} 

Next, the \textsc{BoussClaw} simulations are compared
with those of other Boussinesq solvers, namely
 \textsc{Funwave} \citep{shi2012high}, \textsc{GloBouss} \citep{lovholt2010coupling} and the Serre type formulation \citep{Lovholt:2013a}.
As noted above, 
the original Serre's equations are enhanced by adding the \citet{schaffer1993boussinesq} terms. 
%And the boundary integral method (BIM) for the full potential theory is also considered. 
%The threshold of the wave breaking is not used in this section. 

\begin{figure}[!htb]
\centering
\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_fun_glob_150.png}\\
%\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_fun_glob_160.png}\\
\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_fun_glob_170.png}\\
\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_fun_glob_180.png}
\caption{Snapshots of BIM, Serre, \textsc{GloBouss}, \textsc{BoussClaw}
and \textsc{Funwave} at t = $15$, $17$ and $18$.
The \textsc{BoussClaw} is used with B=$1/15$,
and the Peregrine's form is used for \textsc{GloBouss}.}
\label{fig:bim_boussclaw_fun}
\end{figure}

In Figure \ref{fig:bim_boussclaw_fun}, snapshots from different
numerical models are shown at t=$15$, $17$ and $18$. 
At t=$15$, the computational results
from different numerical tools show slightly different results,
but the general pattern is similar.
At t=$17$, some discrepancies are observed 
that can be split into two groups, and
\textsc{GloBouss} and \textsc{Funwave} 
are similar while \textsc{BoussClaw}
and Serre's results are similar. 
The wave amplitudes computed by \textsc{GloBouss} and \textsc{Funwave},
are more than 10 \% larger than BIM.
The wave amplitude continues to increase 
with \textsc{GloBouss} and \textsc{Funwave} simulations,
and the difference from the BIM result becomes larger at t = $18$. 
The results from the Serre and \textsc{BoussClaw} models clearly
more similar to those of the BIM model. 
Especially, the wave amplitudes are correctly determined by these models.

\subsection{Wave Breaking}

In order to catch wave breaking in a heuristic fashion,
we may choose to invoke the threshold $\epsilon_B:=\eta/h$ for \textsc{BoussClaw}.
When the threshold is reached, the wave breaking is supposed to be initiated, 
and the dispersive terms are suppressed. 
At the breaking, the set of equations is locally 
switched to the shallow water equations for the corresponding wave packet,
and the trailing waves are solved with the Boussinesq equations
if the thresholds are not reached. 
In the numerical simulation of the \textsc{BoussClaw} model,
the ratio $\epsilon_B$ reaches the threshold $0.8$ at $t=14.9$
when the peak of the wave is at $x=8.03227$.
In the following, we explore the wave evolution with and without
the application of this threshold.
%At this time, the wave breaking is assumed to start, 
%and the governing equations are switched 
%to the shallow water equations.
%Meanwhile, the BIM results show $x=4.02$ m and  $\epsilon_B=2.01$ at the start of the wave breaking.

\begin{figure}[!htb]
\centering
\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_etaB8_150.png}\\
%\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_etaB8_160.png}\\
\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_etaB8_170.png}\\
\includegraphics[width=.9\textwidth]{_fig/bim_boussclaw_etaB8_186.png}
\caption{Comparison of BIM, \textsc{BoussClaw} and NLSW 
with $\epsilon_B=0.8$ at t =$15$, $17$ and $18.6$.}
\label{fig:boussclaw_th08}
\end{figure}

In Figure \ref{fig:boussclaw_th08}, snapshots are shown at 
t=$15$, $17$, and $18.6$ from BIM, \textsc{BoussClaw} 
and NLSW.
At t=$15$, the difference between BIM and \textsc{BoussClaw}
is small, but the difference becomes noticeable 
in the wave shape and amplitude at t = $17$ and $18.6$ . 
As the governing equations are switched to the shallow water equations,
the a bore is forming, and the wave amplitude decreases.

Figure \ref{fig:wave_break_criteria} shows 
the amplitude to depth ratio, $\epsilon_B$, as function of the crest location. 
With BIM simulations, the wave starts breaking at $x=4.09$. 
When the crest in the \textsc{BoussClaw} simulation reaches $x=4.09$ we find
$A/h=1.97$, the ratio of wave speed to celerity ($u/\sqrt{gH}$)
is $1.034$ and maximum surface slope angle of $39.1^\circ$.

\begin{figure}[!htb]
\centering
\includegraphics[width=.7\textwidth]{_fig/wave_break}
\caption{Plot of $A/\eta$, $u_s/c$ and maximum angle of waves vs. crest location. 
BIM shows the wave break at $x=4.09$. }
\label{fig:wave_break_criteria}
\end{figure}

\subsection{Wave Energy}

The wave energy is nearly conserved when the wave is smooth, 
but decreases as the wave breaks.
The wave energy expressions 
for the shallow water equations and Boussinesq equations
are $E_0$ and $E_0+E_1$  respectively, 
which are given in (\ref{eq:energy_e0}) and (\ref{eq:energy_e1}). 

\begin{figure}[!htb]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{_fig/e0_boussclaw_eb08.png}
        \caption{$E_0$}
        \label{fig:e0_boussclaw_eb08}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{_fig/e1_boussclaw_eb08.png}
        \caption{$E_0+E_1$}
        \label{fig:e1_boussclaw_eb08}
    \end{subfigure}
    \caption{Energy plots of NLSW and \textsc{BoussClaw}.
    The vertical line is at $x=8.03227$ m where $\epsilon_B=0.8$,
    and the governing equations are switched to the NLSW from
    the Boussinesq equations. }
    \label{fig:energy_boussclaw_swe}
\end{figure}

In Figure \ref{fig:energy_boussclaw_swe}, 
the wave energy $E_0$ and $E_0+E_1$ are shown. 
The energy denotes the aggregate 
of the wave energy in the entire computational domain 
and is shown as function of the crest location.
In the left panel, 
the energy $E_0$ is well-preserved 
for the shallow water equations 
before the wave forms a shock,
and then the energy dissipates after a shock is formed.
In the right panel, 
$E_0+E_1$ is well-preserved for the \textsc{BoussClaw} simulation during deep water propagation, but
the value decreases slightly as the wave steepens
near the shoreline.
When the threshold $\epsilon_B=0.8$ is used,
the energy $E_0+E_1$ is well-preserved 
as shown on the right figure before the threshold is reached. 
When the crest is located
at $x=8.03227$ with $\epsilon_B=0.8$, 
the wave energy $E_0$ on the left figure 
does not decrease immediately.
The energy $E_0$ is preserved for a while, 
then starts to decrease as a shock is formed. 

\section{Conclusion}
\label{sec:conclusion}

In the present paper we have presented a new operational 
Boussinesq type model, \textsc{BoussClaw},
for modeling fully non-linear dispersive tsunami propagation, taking also into account drying-wetting during inundation and withdrawal on the beach.
\textsc{BoussClaw} resembles much used operational models such as \textsc{Funwave-TVD} and
\textsc{Coulwave-TVD}, but is based on a slightly simpler and more transparent set of governing equations,
and has a slightly different numerical scheme. We have tested numerical implementation towards
analytical solitary wave expressions as well as laboratory experiments.

Making use of the experiments of \citet{synolakis1987runup} 
enabled us to
constrain a set of different long wave models, including \textsc{BoussClaw}, as well as a full potential
BIM reference model. Using the BIM, we were able to explore in detail the post-breaking behaviour,
and to identify the point of breaking accurately. This was useful for determining the 
validity of the respective long wave models. First, we found that by using standard NLSW models,
the point of breaking will be located too far offshore. Boussinesq models
provide the opportunity of providing a more accurate description of the near shore propagation and shoaling. 
However, in current practise the Boussinesq terms are often omitted near shore through the $A/h>0.8$ threshold criteria.
As a consequence, the point of breaking may be misinterpreted also in Boussinesq type models.

In the present example, we investigated the near shore propagation over a relatively gentle shelf of $1/19.85$ slope,
and in this case the actual onset of breaking occurred for $A/h \approx 2$, which is significantly later
than what would be predicted in any standard approach (NLSW or Boussinesq). As demonstrated in this paper,
the combined effects of non-linearities and dispersion influence the solution markedly, when accumulated to the point
of breaking. It is noted that the artificial effect discovered would depend on the slope, 
and the $A/h=0.8$ limited may well work better on a much gentler slope as it is primarly derived based on 
solitary wave evolution on constant depth. On the other hand, $1/19.85$ slope is already quite gentle,
and the offset between the reference solution and Boussinesq models using this criteria may
be even more pronounced for steeper slopes.

%{\em What should the main conclusions be}
%\begin{itemize}
%\item \textsc{BoussClaw} works.
%\item Shallow water models and composite Boussinesq/NLSW models
%      may give large errors in breaking point and wave shape
%\item Breaking does not really occur before the local amplitude is much higher than 0.8 time the depth -- a limit that is inspired by the existence of solitary wave solution in full potential theory.
%The 0.8 limit  may be better on even gentler slopes.
%\item Effects of nonlinearities in the dispersion does influence the solution markedly, when accumulated up to the point of breaking.
%\end{itemize}

\section*{References}

\bibliography{mybibfile}

\appendix

\section{Comparison of the Boussinesq equations}
\label{append:a}

A class of the Boussinesq-type equations can be written 
in the following form,
\begin{flalign}
& (H)_t + (Hu)_x = 0, \\
& (Hu)_t + \left( Hu^2 + \frac{gH²}{2} \right)_x + gHh_x + \psi = 0,
\end{flalign}
where $\psi$ represents dispersion terms.
If 
\begin{flalign}
\psi = \frac{Hh^2}{6} u_{xxt} - \frac{Hh}{2} (hu)_{xxt},
\label{eq:peregrine_disp}
\end{flalign}
then these are called 
the Peregrine's equations.

We claim that the Boussinesq equations 
by \citet{schaffer1993boussinesq}
can be approximately reduced to the Peregrine's form when $B=0$.
Since $H=h+\eta$, the dispersion terms of Sch{\"a}ffer and Madsen
with $B=0$, can be written as, 
\begin{flalign}
\psi = & \frac{1}{6}h^3 \left(\frac{Hu}{h} \right)_{xxt}
- \frac{1}{2}h^2 (Hu)_{xxt} \nonumber \\
= & \frac{1}{6}h^3 u_{xxt}
+ \frac{1}{6}h^3 \left( \frac{\eta u}{h} \right)_{xxt}
- \frac{1}{2}h^2 (hu)_{xxt} - \frac{1}{2}h^2 (\eta u)_{xxt} \nonumber \\
= & \frac{H h^2}{6} u_{xxt} - \frac{H h}{2} (hu)_{xxt} \nonumber \\
&- \frac{\eta h^2}{6} u_{xxt}
+ \frac{h^3}{6} \left( \frac{\eta u}{h} \right)_{xxt}
+ \frac{\eta h}{2} (hu)_{xxt}
- \frac{h^2}{2} (\eta u)_{xxt} \label{eq:append_schaffer_disp1} \\
= & \frac{H h^2}{6} u_{xxt} - \frac{H h}{2} (hu)_{xxt}
+ \mathcal{O}(\epsilon). \nonumber
\end{flalign}
Because the last four terms in (\ref{eq:append_schaffer_disp1})
are $\mathcal{O}(\epsilon$),
the dispersion terms of Sch{\"a}ffer and Madsen are approximately same as
the Peregrine's. 
However, due to the higher order terms in (\ref{eq:append_schaffer_disp1}),
Sch{\"a}ffer and Madsen's wave model has lower peak 
near the wave break
than the Peregrine's model. 

Now we will study the connection between 
Sch{\"a}ffer and Madsen's equations 
and Serre's equations. 
Use $H=h+\eta$ and $\eta_t = H_t = -(Hu)_x$,
and assume $\eta_{xx}$ is small. 
The dispersion terms of Sch{\"a}ffer and Madsen 
can be rewritten in a different form, 
\begin{flalign*}
\psi = & \frac{1}{6}h^3 \left(\frac{Hu}{h} \right)_{xxt}
- \frac{1}{2}h^2 (Hu)_{xxt} \\
= & - Hh h_xu_{xt} -\frac{1}{3} H h^2 u_{xxt}- H h \eta_xu_{xt} \\
& - \frac{1}{6} Hh \eta u_{xxt} 
+ \frac{1}{6} h \eta^2 u_{xxt} + h \eta (h+\eta)_x u_{xt} 
+ \frac{1}{6} h^3 \left( \frac{\eta u}{h} \right)_{xxt}
\end{flalign*}
Meanwhile
\begin{flalign*}
\left( \frac{\eta u}{h} \right)_{xxt} 
= & -\frac{2 h_x}{h^2}\eta u_{xt} 
+ \frac{2}{h} \eta_x u_{xt}
+ \frac{1}{h} \eta u_{xxt} 
+ \frac{2 h_x}{h^2} (Hu)_x u_{x} \\
&- \frac{2}{h} (Hu)_{xx} u_x 
- \frac{1}{h} (Hu)_x u_{xx}.
\end{flalign*}
Therefore $\psi$ reduces to 
\begin{flalign*}
\psi 
= & Hh\eta_xu_{xt} + \left( \frac{2}{3} h_x \eta  
- \frac{2}{3} h \eta_x  \right) hu_{xt} \\
& + \frac{1}{6} h^3 \left(\frac{2 h_x}{h^2} (Hu)_x u_{x}
- \frac{2}{h} (Hu)_{xx} u_x 
- \frac{1}{h} (Hu)_x u_{xx}  \right)  \\
= & - Hh h_xu_{xt} -\frac{1}{3} H h^2 u_{xxt}
+ \left( \frac{2}{3} h_x \eta  
- \frac{2}{3} h \eta_x  \right) hu_{xt} \\
& + \frac{1}{6} h^3 \left(\frac{2 h_x}{h^2} (Hu)_x u_{x}
- \frac{2}{h} (Hu)_{xx} u_x 
- \frac{1}{h} (Hu)_x u_{xx}  \right)
\end{flalign*}
Now consider the last term 
\begin{flalign*}
 & \frac{1}{6} h^3 \left(\frac{2 h_x}{h^2} (Hu)_x u_{x}
- \frac{2}{h} (Hu)_{xx} u_x 
- \frac{1}{h} (Hu)_x u_{xx}  \right) \\
= & \frac{1}{3} h \left( h_x (Hu)_x u_{x}
- h (Hu)_{xx} u_x 
- \frac{h}{2} (Hu)_x u_{xx}  \right) \\
= & \frac{1}{3} h \left( h_x \left( H_xu + Hu_x \right) u_{x}
- h \left( 2H_xu_x + Hu_{xx} \right) u_x 
- \frac{h}{2} (H_xu + Hu_x) u_{xx}  \right) \\
= & \frac{1}{3} h \left( h_x H (u_x)^2 
- 2H_x h (u_x)^2 - H h u_x u_{xx} 
- \frac{h}{2} H_x u u_{xx} - \frac{h}{2} H u_x u_{xx} \right) \\
= & \frac{1}{3} h \left( \left( h_x H - 2H_x h \right) (u_x)^2 
- \frac{3 H h}{2} u_x u_{xx} 
- \frac{h}{2} H_x u u_{xx} \right)
\end{flalign*}
If we rearrange (\ref{eq:madsen_new_disp_x}) and
assume that $h_x\eta$, $h_{xx}$ and $\eta_{xx}$ are small,
then 
the Madsen's dispersion terms can be written as
\begin{flalign*}
\psi 
\approx & - Hh h_xu_{xt} -\frac{Hh^2}{3} u_{xxt}- H h \eta_xu_{xt}
- \frac{1}{6} Hh \eta u_{xxt} 
+ \frac{1}{6} h^3 \left( \frac{\eta u}{h} \right)_{xxt}.
\end{flalign*}
Since $\eta_t = -(Hu)_x$, we have
\begin{flalign*}
\left( \frac{\eta u}{h} \right)_{xxt} 
\approx & \frac{2 \eta_x}{h} u_{xt}
+ \frac{\eta}{h} u_{xxt}  &+ \frac{2 h_x}{h^2} (Hu)_x u_{x}
- \frac{2}{h} (Hu)_{xx} u_x 
- \frac{1}{h} (Hu)_x u_{xx}.
\end{flalign*}
Plugging in and dropping small terms yields to 
\begin{flalign}
\psi 
\approx & - Hh h_xu_{xt} -\frac{Hh^2}{3} u_{xxt}- H h \eta_xu_{xt} 
- \frac{1}{6} Hh \eta u_{xxt} \nonumber \\
& +\frac{h^2\eta_x}{3} u_{xt}
+ \frac{h^2\eta}{6} u_{xxt} + \frac{h h_x}{3} (Hu)_x u_{x}
- \frac{h^2}{3} (Hu)_{xx} u_x 
- \frac{h^2}{6} (Hu)_x u_{xx} \nonumber \\
\approx & - Hh h_xu_{xt} -\frac{Hh^2}{3} u_{xxt}- H h \eta_xu_{xt} \nonumber \\
& +\frac{h^2\eta_x}{3} u_{xt}
 + \frac{h h_x}{3} (Hu)_x u_{x}
- \frac{h^2}{3} (Hu)_{xx} u_x 
- \frac{h^2}{6} (Hu)_x u_{xx}. \label{eq:madsen_disp_v3}
\end{flalign}
%\marginpar{\small I am not sure how to conclude the relation between Boussinesq and Serre.}

The Serre's equations of \citep{su1969korteweg}
has the following dispersion terms,
\begin{flalign}
\psi= &-Hhh_xu_{xt} - \frac{Hh^2}{3}u_{xxt}
- Hh\eta_xu_{xt} \nonumber \\
& - \frac{2}{3} Hh\eta u_{xxt}
+ \frac{Hh^2}{3}\left[ (u_x)^2-uu_{xx} \right]_x.
\label{eq:serre_disp}
\end{flalign}
It is observed that (\ref{eq:madsen_disp_v3}) and (\ref{eq:serre_disp}) share common terms.
As shown in Figure \ref{fig:bim_boussclaw_fun}
numerical results also show that Sch{\"a}ffer and Madsen's 
model is more similar to Serre's equations than Peregrine's equations.

\section{Stability of the hybrid scheme}
\label{append:stab}
It is difficult to analyze the numerical stability for  our full Boussinesq
equations. 
To obtain some insight in the  stability of the proposed hybrid numerical scheme,
we thus consider a closely related, but simpler, equation, namely the 
linearized Benjamin-Bona-Mahony (BBM)
equation (\cite{benjamin1972model}) 
\begin{align}
u_t + c u_x = \frac{h^2}{6}u_{txx},
\label{eq:basic_1}
\end{align}
where $c=\sqrt{gh}$.
This equation describes weakly dispersive, uni-directional waves in constant
depth. The equation replaces the momentum equation, whereas no separate
continuity equation is involved.

Following the steps of section \ref{sec:Num_scheme},
we rearrange 
the equation (\ref{eq:basic_1}) as
\begin{align}
(I-D)(u_t + c u_x) +Du_x = 0, \label{eq:basic_2}
\end{align}
where $D=\frac{h^2}{6}\partial_x^2$.
The first step of  hybrid scheme for  this equation is integration of
 the advection equation
\begin{align}
u_t + c u_x = 0,
\label{eq:append_advec}
\end{align}
by the finite volume method. 
Then the Runge-Kutta  method is applied to,
\begin{align}
(1-D)u_t + cDu_x = 0.
\label{eq:append_mom_fdm}
\end{align}
which is the counterpart to  (\ref{eq:hybrid_mom_fdm}).

If we use the centered spatial difference approximation of $O(\Delta x^2)$
accuracy on a regular grid we may employ a standard von Neumann analysis where we calculate the growth of an harmonic mode over a single time step.
Expressing the coefficients of the velocity array before the time step as  $u_j= e^{i\xi j \Delta x}$ we then replace the coefficient of $\textbf{M}^q$, defined in section \ref{sec:Num_scheme}, 
by $M_j^q=U_j^q= g^qe^{i\xi j \Delta x}$, 
where $q$ is 1, 2, 3, 4 or +. Correspondingly, the coefficients of the $\mathbf{S}^k$ array, which contains auxiliary,  nodal values for $u_t$,  is
expressed $(S_j^k)= s^k e^{i\xi j \Delta x}$. 

The stability  of the first step, (\ref{eq:append_advec}),  is assured by the standard CFL criterion
\[\frac{c\Delta t}{\Delta x} <1.\]
If we instead solve the NLSW equations, as in BoussClaw, $c$ must be replaced by the nonlinear characteristic velocity, which may lead to a more strict criterion. However, the method employed in the first step is not suited for a von Neumann stability analysis and we thus apply this technique to the second step only. 
 Hence, we may put $g^1$ to unity, but it is preferable to retain it in the calculations. 
The Runge-Kutta scheme for time stepping, (\ref{eq:rk4_S}), may  now be
expressed as
\begin{flalign} 
g^2 = g^1 + \frac{\Delta t}{2}s^1, \quad
g^3 = g^1 + \frac{\Delta t}{2}s^2, \quad
g^4 = g^1 + \Delta t s^3,
\label{eq:rk4_Neumann}
\end{flalign}
The discrete version of (\ref{eq:append_mom_fdm}), which is the counterpart to
(\ref{eq:rk4_1}) for the BBM equation reads 
\begin{align*}
& S_j^k - \frac{h^2}{6}\frac{S_{j+1}^k-2S_j^k+S_{j-1}^k}{\Delta x^2} = 
-\frac{ch^2}{6}\frac{U_{j+2}^k - 2U_{j+1}^k +2U_{j-1}^k -U_{j-2}^k}{2\Delta x^3},
\end{align*}
which, inserted the harmonic expressions, implies
\begin{align}
s^k=i \frac{\gamma}{\Delta t} g^k,\quad \gamma = c\Delta t \frac{ 2\sin(\xi \Delta x)(1-  \cos(\xi \Delta x)) }
                     { 6\Delta x^3h^{-2} +2\Delta x(1-\cos(\xi \Delta x))},
\label{append:rk4_1}
\end{align}
where the $\Delta t$ factors are included for convenience.
The assembling of the intermediate values in the Runge-Kutta procedure, 
(\ref{eq:rk4_assemble}), now yields 
\begin{flalign}
g^+ & = g^1 + \frac{\Delta t}{6} \left[
s^1+2s^2+2s^3+s^4
\right]. 
\label{append:rk4_assemble}
\end{flalign}

By combination of (\ref{eq:rk4_Neumann}) and (\ref{append:rk4_1}) $s^k$ and $g^k$, $k=1..4$ can be calculated successively  and combined in (\ref{append:rk4_assemble}) to provide
the value of $g^+$, 
\begin{align*}
g^+(\gamma) & = \left(1-
\frac{1}{2}\gamma^2 +\frac{\gamma^4}{24} + \left(\frac{\gamma^3}{6} -\gamma \right)i\right)g^1 \\
|g^+(\gamma)|^2 & = \left(1 + \frac{1}{4}\gamma^4 + \frac{\gamma^8}{24^2} -\gamma^2 + \frac{\gamma^4}{12}
-\frac{\gamma^6}{24} + \gamma^2 + \frac{\gamma^6}{36} -\frac{\gamma^4}{3}\right)|g^1|^2 \\
& = \left(1 -\frac{1}{72}\gamma^6 + \frac{1}{576}\gamma^8\right)|g^1|^2.
\end{align*}
Stability requires  $|g^+(\gamma)/g^1|<1$ which is 
equivalent to  $|\gamma|<2\sqrt{2}$. Moreover, it is easily seen that 
$\gamma<c\Delta t/\Delta x$. 
Hence, a sufficient condition for stability of the second step of the hybrid scheme is 
\[
\frac{c\Delta t}{\Delta x} < 2\sqrt{2}.
\] 
This is more relaxed than the CFL condition for the advection equation
(\ref{eq:append_advec}). 
Therefore, if the CFL condition is satisfied in the advection equation,
the fractional step is always stable with the suggested numerical scheme. 


\section{Energy estimates and dissipation}
\label{append:energy}

\subsection{Velocity field}

To derive the energy estimates for the Boussinesq-type equations, 
we define the depth-averaged velocity as,  
\begin{flalign*}
\bar{u} = \frac{1}{H}\int_{-h}^{\epsilon \eta} u dz .
\end{flalign*}
Then the velocity $u$ can be expressed as
$u = \bar{u} + \mu^2 u_1$ where
\begin{align}
\int_{-h}^{\epsilon \eta} u_1 dz=0. \label{eq:avg_u1}
\end{align}
Then the kinematic boundary condition at the bottom and zero divergence
implies
\begin{flalign*}
w = -h_x u  - \bar{u}_x (z+h) + O(\mu^2). 
\end{flalign*}

\subsection{Energy integrals}

The potential energy density per horizontal area is 
\begin{flalign*}
V = \int_{-h}^{\epsilon \eta} g z dz = \frac{1}{2}\epsilon^2 g \eta^2 
- \frac{1}{2} g h^2, 
\end{flalign*}
where the last term $\frac{1}{2} g h^2$ is the equilibrium energy.
The kinematic energy density has two contributions,
\begin{flalign*}
T=T_u+T_w; 
\quad T_u = \frac{1}{2}\epsilon^2 \int_{-h}^{\epsilon \eta} u^2 dz, 
\quad T_w = \frac{1}{2}\epsilon^2 \mu^2 \int_{-h}^{\epsilon \eta} w^2 dz. 
\end{flalign*}
For the horizontal part, $T_u$ is 
\begin{flalign*}
T_u = \frac{1}{2}\epsilon^2 \int_{-h}^{\epsilon \eta} u^2 dz
= \frac{1}{2}\epsilon^2 \int_{-h}^{\epsilon \eta} 
\bar{u}^2+2\mu^2\bar{u}u_2 + \mu^4u_1^2 dz
= \frac{1}{2}\epsilon^2 H \bar{u}^2 + O(\epsilon^2 \mu^4),
\end{flalign*}
since $\bar{u}$ is independent of $z$ and by (\ref{eq:avg_u1}).
Assuming $\frac{1}{H}\int_{-h}^{\epsilon \eta} u^2 dz = \bar{u}^2$,
the vertical part is 
\begin{flalign*}
\quad T_u & = \frac{1}{2}\epsilon^2 \mu^2 \int_{-h}^{\epsilon \eta} 
h_x^2u^2 +2h_xu\bar{u}_x(z+h)
+ \bar{u}_x^2 (z+h)^2 dz + O(\epsilon^2\mu^4) \\
& = \frac{1}{2}\epsilon^2 \mu^2 H
\left(
h_x^2 \bar{u}^2 + H h_x\bar{u} \bar{u}_x + \frac{1}{3} H^2 \bar{u}_x^2
\right) + O(\epsilon^2\mu^4).
\end{flalign*}
Thus the energy of a wave can be approximated as 
\begin{flalign*}
& E = \epsilon^2 \left( E_0 +\mu^2 E_1 + O (\mu^4)\right)
\end{flalign*}
where
\begin{flalign*}
& E_0 = \frac{1}{2}\left( g\eta^2 + H\bar{u}^2 \right), \\
& E_1 = \frac{1}{6}H^3\bar{u}_x^2
+ \frac{1}{2}H^2h_x\bar{u}\bar{u}_x + \frac{1}{2}Hh_x^2\bar{u}^2.
\end{flalign*}

\end{document}
---
